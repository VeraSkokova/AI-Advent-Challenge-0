# ü™ô –î–µ–Ω—å 8. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¢–æ–∫–µ–Ω–∞–º–∏ (Token Management)

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ (–≤—Ö–æ–¥/–≤—ã—Ö–æ–¥) –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–∞—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- `input_tokens` / `prompt_tokens`: –í–∑—è—Ç—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞ API.
- `output_tokens` / `completion_tokens`: –í–∑—è—Ç—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞ API.
- –ö–æ–º–∞–Ω–¥–∞ `limit <n>`: –î–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤.
- –ö–æ–º–∞–Ω–¥–∞ `overflow_input`: –î–ª—è —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∞ –≤—Ö–æ–¥–Ω–æ–≥–æ –æ–∫–Ω–∞.

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

### 1. –í–ª–∏—è–Ω–∏–µ –¥–ª–∏–Ω—ã –∑–∞–ø—Ä–æ—Å–∞ (Short vs Long)

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ú–æ–¥–µ–ª—å | –í—Ö–æ–¥ (tks) | –í—ã—Ö–æ–¥ (tks) | –í—Ä–µ–º—è (ms) | –°—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ) |
|----------|--------|------------|-------------|------------|---------------|
| **–ö–æ—Ä–æ—Ç–∫–∏–π** ("–ü—Ä–∏–≤–µ—Ç") | Yandex Lite | 120 | 1 | 608 | 0.0242 |
| **–î–ª–∏–Ω–Ω—ã–π** ("–°–∫–∞–∑–∫–∞") | Yandex Lite | 122 | **1000** ‚ö†Ô∏è | 11446 | 0.2244 |
| **–î–ª–∏–Ω–Ω—ã–π** ("–°–∫–∞–∑–∫–∞") | Qwen 235B | 110 | 731 | 24483 | 0.7860 |

**–ù–∞–±–ª—é–¥–µ–Ω–∏–µ:**
Yandex Lite –ø—Ä–∏ —Å–ª–æ–∂–Ω–æ–π –∑–∞–¥–∞—á–µ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–∏ JSON —É—à–ª–∞ –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º—É—Å–æ—Ä–∞ (`{":: {":...`), –ø–æ–∫–∞ –Ω–µ —É–ø–µ—Ä–ª–∞—Å—å –≤ –ª–∏–º–∏—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ (1000). –≠—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—ã—Ö–æ–¥–∞ –¥–ª—è –¥–µ—à–µ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π.

### 2. –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞ (Output Overflow)

**–¢–µ—Å—Ç:** –õ–∏–º–∏—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `10` —Ç–æ–∫–µ–Ω–æ–≤ (`limit 10`).

| –ú–æ–¥–µ–ª—å | –û—Ç–≤–µ—Ç | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|-------|-----------|
| **Yandex Lite** | `{"> ": {">` | ‚ùå JSON —Å–ª–æ–º–∞–Ω (–º—É—Å–æ—Ä) |
| **Yandex Pro** | `{"type": "creative", "content":` | ‚ùå JSON —Å–ª–æ–º–∞–Ω (–Ω–µ –∑–∞–∫—Ä—ã—Ç) |
| **Qwen 235B** | `{\n "type": "creative",\n "` | ‚ùå JSON —Å–ª–æ–º–∞–Ω (–Ω–µ –∑–∞–∫—Ä—ã—Ç) |

**–í—ã–≤–æ–¥:** –ü—Ä–∏ –∂–µ—Å—Ç–∫–æ–º –ª–∏–º–∏—Ç–µ —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç–≤–µ—Ç –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏. –ï—Å–ª–∏ –æ–∂–∏–¥–∞–µ—Ç—Å—è JSON, –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –∫ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ (`try-catch` –∏–ª–∏ streaming parser).

### 3. –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Ö–æ–¥–∞ (Input Overflow)

**–¢–µ—Å—Ç:** –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª–∏–Ω–æ–π 180 000 —Å–∏–º–≤–æ–ª–æ–≤ (~36k —Ç–æ–∫–µ–Ω–æ–≤).

**–†–µ–∑—É–ª—å—Ç–∞—Ç (–õ–æ–≥):**
üö® Trying input overflow with length=180000 chars
‚ùå Overflow error: API Error: 400 Bad Request
{
"error": "number of input tokens must be no more than 32768, got 36120"
}

text

**–í—ã–≤–æ–¥:**
1.  **–ñ–µ—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç:** YandexGPT –∏–º–µ–µ—Ç –∂–µ—Å—Ç–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤ **32 768 —Ç–æ–∫–µ–Ω–æ–≤**.
2.  **–ü–æ–≤–µ–¥–µ–Ω–∏–µ:** API –Ω–µ –æ–±—Ä–µ–∑–∞–µ—Ç –≤—Ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É `400`.
3.  **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±—è–∑–∞–Ω–æ —Å–∞–º–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –¥–ª–∏–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ (Conversation History) –∏ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.

---

## üí° –ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã

1.  **–ë—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Ç—è–∂–µ–ª—ã–º –º–æ–¥–µ–ª—è–º (Qwen) –º–æ–≥—É—Ç —Å—Ç–æ–∏—Ç—å –¥–æ 1 —Ä—É–±–ª—è –∑–∞ –æ—Ç–≤–µ—Ç. –õ–µ–≥–∫–∏–µ –º–æ–¥–µ–ª–∏ (Lite) –≤ 10-30 —Ä–∞–∑ –¥–µ—à–µ–≤–ª–µ, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞.
2.  **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ù–µ–ª—å–∑—è –¥–æ–≤–µ—Ä—è—Ç—å –≤—ã–≤–æ–¥—É –¥–µ—à–µ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Ä–∏—Å–∫ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è –∏ —Ç—Ä–∞—Ç—ã –±—é–¥–∂–µ—Ç–∞).
3.  **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º "—Å–∫–æ–ª—å–∑—è—â–µ–≥–æ –æ–∫–Ω–∞" (Sliding Window) –¥–ª—è —á–∞—Ç–∞, —á—Ç–æ–±—ã –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–ª–∞ 32k —Ç–æ–∫–µ–Ω–æ–≤.